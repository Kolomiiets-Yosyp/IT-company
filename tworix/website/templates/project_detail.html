{% extends "base.html" %}

{% block title %}{{ project.title }}{% endblock %}

{% block content %}
<section class="px-6 lg:px-12 py-20 lg:py-32">
    <div class="max-w-7xl mx-auto">
        <div class="flex flex-col lg:flex-row gap-16">
            <div class="lg:w-2/3">
                {% if project.image %}
                <div class="aspect-video mb-8 sliced-border border-2 border-primary/50 overflow-hidden">
                    <img src="{{ project.image.url }}" alt="{{ project.title }}" class="w-full h-full object-cover">
                </div>
                {% endif %}
                <h1 class="text-5xl lg:text-7xl font-black uppercase tracking-tighter leading-none text-primary italic">
                    {{ project.title }}
                </h1>
                <div class="prose prose-invert text-white/80 text-lg leading-relaxed mt-8">
                    <p>{{ project.description|linebreaks }}</p>
                </div>
                
                {% if project.media.all %}
                <div class="mt-12 space-y-8">
                    <h2 class="text-3xl font-black uppercase tracking-tighter text-primary mb-6">ADDITIONAL_MEDIA</h2>
                    <div class="grid grid-cols-1 gap-8">
                        {% for media_item in project.media.all %}
                            {% if media_item.media_type == 'image' and media_item.image %}
                            <div class="sliced-border border-2 border-white/10 overflow-hidden">
                                <img src="{{ media_item.image.url }}" alt="{{ project.title }} - фото {{ forloop.counter }}" class="w-full h-auto object-cover">
                            </div>
                            {% elif media_item.media_type == 'video' and media_item.video_url %}
                            <div class="aspect-video sliced-border border-2 border-white/10 overflow-hidden bg-black">
                                {% if 'youtube.com/embed' in media_item.video_url or 'youtu.be' in media_item.video_url or 'youtube.com/watch' in media_item.video_url %}
                                    {% if 'youtube.com/embed' in media_item.video_url %}
                                        <iframe class="w-full h-full" src="{{ media_item.video_url }}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                                    {% else %}
                                        <div class="w-full h-full flex items-center justify-center text-white/50 p-4">
                                            <p class="text-center text-sm">Please use embed URL for YouTube<br/>(e.g., https://www.youtube.com/embed/VIDEO_ID)</p>
                                        </div>
                                    {% endif %}
                                {% elif 'vimeo.com' in media_item.video_url %}
                                    {% if 'player.vimeo.com' in media_item.video_url %}
                                        <iframe class="w-full h-full" src="{{ media_item.video_url }}" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen></iframe>
                                    {% else %}
                                        <div class="w-full h-full flex items-center justify-center text-white/50 p-4">
                                            <p class="text-center text-sm">Please use embed URL for Vimeo<br/>(e.g., https://player.vimeo.com/video/VIDEO_ID)</p>
                                        </div>
                                    {% endif %}
                                {% else %}
                                    <iframe class="w-full h-full" src="{{ media_item.video_url }}" frameborder="0" allowfullscreen></iframe>
                                {% endif %}
                            </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>
            <div class="lg:w-1/3">
                <div class="bg-surface-dark border border-white/10 p-8 sliced-border sticky top-24">
                    <h3 class="text-xs font-bold text-white/50 tracking-widest uppercase mb-6">INTEL_OVERVIEW</h3>
                    <div class="space-y-4 font-mono text-sm">
                        <div class="flex justify-between items-center">
                            <span class="text-white/40">PROJECT_ID:</span>
                            <span class="text-primary">TVX_{{ project.id|stringformat:"03d" }}</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white/40">STATUS:</span>
                            <span class="text-primary">OPERATIONAL</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-white/40">GRID_SECTOR:</span>
                            <span class="text-primary">ALPHA</span>
                        </div>
                    </div>
                    <div class="mt-10 pt-6 border-t border-white/10">
                         <a href="{% url 'lab' %}" class="group relative bg-white text-black font-black px-10 py-5 text-xl sliced-border hover:translate-x-2 transition-transform w-full text-center inline-block">
                            <span class="relative z-10">RETURN_TO_LAB</span>
                            <div class="absolute inset-0 bg-primary translate-x-2 translate-y-2 -z-10 group-hover:translate-x-1 group-hover:translate-y-1 transition-transform"></div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
.prose {
    max-width: none;
}
</style>
{% endblock %}
